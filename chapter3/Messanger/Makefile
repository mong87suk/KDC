.SUFFIXES: .c.o

DBLINKED_LIST = DBLinkedList

SERVER = server

CLIENT = client

CM_MANAGER_OBJECT = cm_manager.o

SM_MANAGER_OBJECT = sm_manager.o

MSG_MANAGER = msg_manager.o

DBLINKED_LIST_OBJECT = DBLinkedList.o

SERVER_OBJECT = server.o

CLIENT_OBJECT = client.o

SHARED_LIBRARY = lib$(DBLINKED_LIST).so

CFLAGS += -Wall -g

.c.o:
	$(CC) -c $(CFLAGS) -o $@ $<

all: $(SERVER) $(CLIENT)

$(SERVER): $(SHARED_LIBRARY) $(SERVER_OBJECT) $(SM_MANAGER_OBJECT) $(MSG_MANAGER)
	$(CC) -L. -Wall -o $(SERVER) $(SERVER_OBJECT) $(SM_MANAGER_OBJECT) $(MSG_MANAGER) -l$(DBLINKED_LIST)

$(CLIENT): $(CLIENT_OBJECT) $(CM_MANAGER_OBJECT) $(MSG_MANAGER)
	$(CC) -o $(CLIENT) $(CLIENT_OBJECT) $(MSG_MANAGER) $(CM_MANAGER_OBJECT)

$(SHARED_LIBRARY):$(DBLINKED_LIST_OBJECT)
	$(CC) -shared -o $@ $^

$(DBLINKED_LIST_OBJECT):
	$(CC) -c -Wall -fpic $(DBLINKED_LIST).c

clean:
	$(RM) $(SERVER) $(CLIENT) *.o *.so*
